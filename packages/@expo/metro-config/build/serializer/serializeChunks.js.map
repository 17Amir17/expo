{"version":3,"file":"serializeChunks.js","names":["_assert","data","_interopRequireDefault","require","_getAssets","_sourceMapString","_bundleToString","_countLines","_path","_pathToRegexp","_exportHermes","_exportPath","_baseJSBundle","_getCssDeps","obj","__esModule","default","_defineProperty","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","graphToSerialAssetsAsync","config","serializeChunkOptions","props","_config$serializer","_config$transformer$a","_config$transformer","_getPlatformOption","_config$transformer$p","_config$transformer2","entryFile","preModules","graph","options","cssDeps","getCssSerialAssets","dependencies","projectRoot","processModuleFilter","rscClientReferenceManifest","forEach","module","output","clientReferences","exports","exp","entryPoint","currentUrl","URL","sourceUrl","pathname","replace","id","chunks","dev","href","name","rscManifestChunkTemplate","find","path","endsWith","code","JSON","stringify","lineCount","countLines","Set","test","pathToRegExp","map","chunkSettings","gatherChunks","entryChunk","values","chunk","isAsync","hasAbsolutePath","dep","deps","has","delete","toCompare","commonDependencies","length","shift","chunk2","commonDeps","filter","push","commonDependenciesUnique","commonChunk","Chunk","chunkIdForModules","requiredChunks","add","jsAssets","serializeChunksAsync","serializer","metroAssets","getMetroAssets","assetPlugins","transformer","platform","getPlatformOption","publicPath","artifacts","rscManifest","assets","constructor","entries","isVendor","getPlatform","assert","transformOptions","getFilename","src","getExportPathForDependencyWithOptions","serverRoot","getFilenameForConfig","serializerConfig","serializeToCodeWithTemplates","serializerOptions","includeSourceMaps","sourceMapUrl","_serializerConfig$get","_serializerConfig$get2","jsSplitBundle","baseJSBundleWithDependencies","runBeforeMainModule","getModulesRunBeforeMainModule","relative","runModule","modulesOnly","size","baseUrl","getBaseUrlOption","splitChunks","getSplitChunksOption","skipWrapping","computedAsyncModulePaths","bundleToString","absolutePath","some","getComputedPathsForAsyncDependencies","includeAsyncPaths","dependency","asyncType","chunkContainingModule","moduleIdName","getAdjustedSourceMapUrl","_this$options$seriali","_this$options$sourceM","inlineSourceMap","_this$options$sourceM2","isAbsolute","filename","isAbsoluteBaseUrl","match","adjustedSourceMapUrl","startsWith","parsed","error","console","serializeToCode","_this$getAdjustedSour","serializeToAssetsAsync","includeBytecode","jsCode","relativeEntry","outputFile","jsAsset","originFilename","type","metadata","requires","source","modules","getSortedModules","createModuleId","_this$options$serverR","sourceMap","sourceMapString","excludeSource","isHermesEnabled","adjustedSource","mapName","hermesBundleOutput","buildHermesBundleAsync","minify","hbc","sourcemap","supportsBytecode","_this$graph$transform","customTransformOptions","engine","getEntryModulesForChunkSettings","settings","sort","join","entryModules","existingChunks","includes","includeModule","entryModule","get","chunksArray","Promise","all","a","b"],"sources":["../../src/serializer/serializeChunks.ts"],"sourcesContent":["/**\n * Copyright Â© 2023 650 Industries.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport assert from 'assert';\nimport {\n  AssetData,\n  MetroConfig,\n  MixedOutput,\n  Module,\n  ReadOnlyGraph,\n  SerializerOptions,\n} from 'metro';\nimport getMetroAssets from 'metro/src/DeltaBundler/Serializers/getAssets';\nimport sourceMapString from 'metro/src/DeltaBundler/Serializers/sourceMapString';\nimport bundleToString from 'metro/src/lib/bundleToString';\nimport countLines from 'metro/src/lib/countLines';\nimport { ConfigT, SerializerConfigT } from 'metro-config';\nimport path from 'path';\nimport pathToRegExp from 'path-to-regexp';\n\nimport { buildHermesBundleAsync } from './exportHermes';\nimport { getExportPathForDependencyWithOptions } from './exportPath';\nimport {\n  ExpoSerializerOptions,\n  baseJSBundleWithDependencies,\n  getBaseUrlOption,\n  getPlatformOption,\n  getSplitChunksOption,\n} from './fork/baseJSBundle';\nimport { getCssSerialAssets } from './getCssDeps';\nimport { SerialAsset } from './serializerAssets';\n\ntype RscClientReference = {\n  /**\n   * ??\n   * `\"/dist/_expo/chunk/client/index.js\"`\n   */\n  id: string;\n  /**\n   * Name of chunk location on server, e.g. `\"/dist/_expo/chunk/client/index.js\"`\n   * In development, we'll use a metro lazy chunk id, e.g. `/client/client/index.bundle?platform=web`\n   */\n  chunks: string[];\n  /** Name of export, e.g. `\"default\"` */\n  name: string;\n};\n\n/**\n * Key is `<id>#<name>`\n * {\n *   \"/components/timer.tsx#default\": {\n *     id: \"/components/timer.js\",\n *     chunks: [ \"/components/timer.js\" ],\n *     name: \"default\"\n *   }\n * }\n */\ntype RscManifest = Record<string, RscClientReference>;\n\ntype Serializer = NonNullable<ConfigT['serializer']['customSerializer']>;\n\ntype SerializerParameters = Parameters<Serializer>;\n\ntype ChunkSettings = {\n  /** Match the initial modules. */\n  test: RegExp;\n};\n\nexport type SerializeChunkOptions = {\n  includeSourceMaps: boolean;\n  includeBytecode: boolean;\n};\n\nexport async function graphToSerialAssetsAsync(\n  config: MetroConfig,\n  serializeChunkOptions: SerializeChunkOptions,\n  ...props: SerializerParameters\n): Promise<{ artifacts: SerialAsset[] | null; rscManifest: RscManifest; assets: AssetData[] }> {\n  const [entryFile, preModules, graph, options] = props;\n\n  const cssDeps = getCssSerialAssets<MixedOutput>(graph.dependencies, {\n    projectRoot: options.projectRoot,\n    processModuleFilter: options.processModuleFilter,\n  });\n\n  const rscClientReferenceManifest: RscManifest = {};\n\n  // Create client reference manifest for server components\n  props[2].dependencies.forEach((module) => {\n    module.output.forEach((output) => {\n      // @ts-expect-error\n      const clientReferences = output.data.clientReferences as unknown as {\n        entryPoint: string;\n        exports: string[];\n      } | null;\n\n      if (clientReferences) {\n        clientReferences.exports.forEach((exp) => {\n          const key = `${clientReferences.entryPoint}#${exp}`;\n\n          const currentUrl = new URL(options.sourceUrl!);\n\n          currentUrl.pathname = clientReferences.entryPoint.replace(\n            /\\.([tj]sx?|[mc]js)$/,\n            '.bundle'\n          );\n\n          rscClientReferenceManifest[key] = {\n            id: clientReferences.entryPoint,\n            chunks: [options.dev ? currentUrl.href : 'TODO-PRODUCTION-CHUNK-NAMES'],\n            name: exp,\n          };\n        });\n      }\n    });\n  });\n\n  const rscManifestChunkTemplate = preModules.find((module) =>\n    module.path.endsWith('.expo/metro/rsc-manifest.js')\n  );\n\n  if (rscManifestChunkTemplate) {\n    rscManifestChunkTemplate.output.forEach((output) => {\n      output.data.code = `global.$$expo_rsc_manifest = ${JSON.stringify(\n        rscClientReferenceManifest\n      )}`;\n      // @ts-expect-error\n      output.data.lineCount = countLines(output.data.code);\n    });\n  }\n\n  // Create chunks for splitting.\n  const chunks = new Set<Chunk>();\n\n  [\n    {\n      test: pathToRegExp(entryFile),\n    },\n  ].map((chunkSettings) => gatherChunks(chunks, chunkSettings, preModules, graph, options, false));\n\n  // Get the common modules and extract them into a separate chunk.\n  const entryChunk = [...chunks.values()].find(\n    (chunk) => !chunk.isAsync && chunk.hasAbsolutePath(entryFile)\n  );\n  if (entryChunk) {\n    for (const chunk of chunks.values()) {\n      if (chunk !== entryChunk && chunk.isAsync) {\n        for (const dep of chunk.deps.values()) {\n          if (entryChunk.deps.has(dep)) {\n            // Remove the dependency from the async chunk since it will be loaded in the main chunk.\n            chunk.deps.delete(dep);\n          }\n        }\n      }\n    }\n\n    const toCompare = [...chunks.values()];\n\n    const commonDependencies = [];\n\n    while (toCompare.length) {\n      const chunk = toCompare.shift()!;\n      for (const chunk2 of toCompare) {\n        if (chunk !== chunk2 && chunk.isAsync && chunk2.isAsync) {\n          const commonDeps = [...chunk.deps].filter((dep) => chunk2.deps.has(dep));\n\n          for (const dep of commonDeps) {\n            chunk.deps.delete(dep);\n            chunk2.deps.delete(dep);\n          }\n\n          commonDependencies.push(...commonDeps);\n        }\n      }\n    }\n\n    // Add common chunk if one exists.\n    if (commonDependencies.length) {\n      const commonDependenciesUnique = [...new Set(commonDependencies)];\n      const commonChunk = new Chunk(\n        chunkIdForModules(commonDependenciesUnique),\n        commonDependenciesUnique,\n        graph,\n        options,\n        false,\n        true\n      );\n      entryChunk.requiredChunks.add(commonChunk);\n      chunks.add(commonChunk);\n    }\n  }\n\n  const jsAssets = await serializeChunksAsync(\n    chunks,\n    config.serializer ?? {},\n    serializeChunkOptions\n  );\n\n  // TODO: Convert to serial assets\n  // TODO: Disable this call dynamically in development since assets are fetched differently.\n  const metroAssets = (await getMetroAssets(graph.dependencies, {\n    processModuleFilter: options.processModuleFilter,\n    assetPlugins: config.transformer?.assetPlugins ?? [],\n    platform: getPlatformOption(graph, options) ?? 'web',\n    projectRoot: options.projectRoot, // this._getServerRootDir(),\n    publicPath: config.transformer?.publicPath ?? '/',\n  })) as AssetData[];\n\n  return {\n    artifacts: [...jsAssets, ...cssDeps],\n    rscManifest: rscClientReferenceManifest,\n    assets: metroAssets,\n  };\n}\n\nclass Chunk {\n  public deps: Set<Module> = new Set();\n  public preModules: Set<Module> = new Set();\n\n  // Chunks that are required to be loaded synchronously before this chunk.\n  // These are included in the HTML as <script> tags.\n  public requiredChunks: Set<Chunk> = new Set();\n\n  constructor(\n    public name: string,\n    public entries: Module<MixedOutput>[],\n    public graph: ReadOnlyGraph<MixedOutput>,\n    public options: ExpoSerializerOptions,\n    public isAsync: boolean = false,\n    public isVendor: boolean = false\n  ) {\n    this.deps = new Set(entries);\n  }\n\n  private getPlatform() {\n    assert(\n      this.graph.transformOptions.platform,\n      \"platform is required to be in graph's transformOptions\"\n    );\n    return this.graph.transformOptions.platform;\n  }\n\n  private getFilename(src: string) {\n    return this.options.dev\n      ? this.name\n      : getExportPathForDependencyWithOptions(this.name, {\n          platform: this.getPlatform(),\n          src,\n          serverRoot: this.options.serverRoot,\n        });\n  }\n\n  private getFilenameForConfig(serializerConfig: Partial<SerializerConfigT>) {\n    return this.getFilename(\n      this.options.dev\n        ? ''\n        : this.serializeToCodeWithTemplates(serializerConfig, {\n            // Disable source maps when creating a sha to reduce the number of possible changes that could\n            // influence the cache hit.\n            serializerOptions: {\n              includeSourceMaps: false,\n            },\n            sourceMapUrl: undefined,\n          })\n    );\n  }\n\n  private serializeToCodeWithTemplates(\n    serializerConfig: Partial<SerializerConfigT>,\n    options: Partial<Parameters<typeof baseJSBundleWithDependencies>[3]> = {}\n  ) {\n    const entryFile = this.name;\n\n    const jsSplitBundle = baseJSBundleWithDependencies(\n      entryFile,\n      [...this.preModules.values()],\n      [...this.deps],\n      {\n        ...this.options,\n        runBeforeMainModule:\n          serializerConfig?.getModulesRunBeforeMainModule?.(\n            path.relative(this.options.projectRoot, entryFile)\n          ) ?? [],\n        runModule: !this.isVendor && !this.isAsync,\n        modulesOnly: this.preModules.size === 0,\n        platform: this.getPlatform(),\n        baseUrl: getBaseUrlOption(this.graph, this.options),\n        splitChunks: getSplitChunksOption(this.graph, this.options),\n        skipWrapping: true,\n        computedAsyncModulePaths: null,\n        ...options,\n      }\n    );\n\n    return bundleToString(jsSplitBundle).code;\n  }\n\n  hasAbsolutePath(absolutePath: string): boolean {\n    return [...this.deps].some((module) => module.path === absolutePath);\n  }\n\n  private getComputedPathsForAsyncDependencies(\n    serializerConfig: Partial<SerializerConfigT>,\n    chunks: Chunk[]\n  ) {\n    const baseUrl = getBaseUrlOption(this.graph, this.options);\n    // Only calculate production paths when all chunks are being exported.\n    if (this.options.includeAsyncPaths) {\n      return null;\n    }\n    const computedAsyncModulePaths: Record<string, string> = {};\n\n    this.deps.forEach((module) => {\n      module.dependencies.forEach((dependency) => {\n        if (dependency.data.data.asyncType === 'async') {\n          const chunkContainingModule = chunks.find((chunk) =>\n            chunk.hasAbsolutePath(dependency.absolutePath)\n          );\n          assert(\n            chunkContainingModule,\n            'Chunk containing module not found: ' + dependency.absolutePath\n          );\n          const moduleIdName = chunkContainingModule.getFilenameForConfig(serializerConfig);\n          computedAsyncModulePaths![dependency.absolutePath] = (baseUrl ?? '/') + moduleIdName;\n        }\n      });\n    });\n    return computedAsyncModulePaths;\n  }\n\n  private getAdjustedSourceMapUrl(serializerConfig: Partial<SerializerConfigT>): string | null {\n    // Metro really only accounts for development, so we'll use the defaults here.\n    if (this.options.dev) {\n      return this.options.sourceMapUrl ?? null;\n    }\n\n    if (this.options.serializerOptions?.includeSourceMaps !== true) {\n      return null;\n    }\n\n    if (this.options.inlineSourceMap || !this.options.sourceMapUrl) {\n      return this.options.sourceMapUrl ?? null;\n    }\n\n    const isAbsolute = this.getPlatform() !== 'web';\n\n    const baseUrl = getBaseUrlOption(this.graph, this.options);\n    const filename = this.getFilenameForConfig(serializerConfig);\n    const isAbsoluteBaseUrl = !!baseUrl?.match(/https?:\\/\\//);\n    const pathname =\n      (isAbsoluteBaseUrl ? '' : baseUrl.replace(/\\/+$/, '')) +\n      '/' +\n      filename.replace(/^\\/+$/, '') +\n      '.map';\n\n    let adjustedSourceMapUrl = this.options.sourceMapUrl;\n    // Metro has lots of issues...\n    if (this.options.sourceMapUrl.startsWith('//localhost')) {\n      adjustedSourceMapUrl = 'http:' + this.options.sourceMapUrl;\n    }\n\n    try {\n      const parsed = new URL(pathname, isAbsoluteBaseUrl ? baseUrl : adjustedSourceMapUrl);\n\n      if (isAbsoluteBaseUrl || isAbsolute) {\n        return parsed.href;\n      }\n\n      return parsed.pathname;\n    } catch (error) {\n      console.error(\n        `Failed to link source maps because the source map URL \"${this.options.sourceMapUrl}\" is corrupt:`,\n        error\n      );\n      return null;\n    }\n  }\n\n  private serializeToCode(serializerConfig: Partial<SerializerConfigT>, chunks: Chunk[]) {\n    return this.serializeToCodeWithTemplates(serializerConfig, {\n      skipWrapping: false,\n      sourceMapUrl: this.getAdjustedSourceMapUrl(serializerConfig) ?? undefined,\n      computedAsyncModulePaths: this.getComputedPathsForAsyncDependencies(serializerConfig, chunks),\n    });\n  }\n\n  async serializeToAssetsAsync(\n    serializerConfig: Partial<SerializerConfigT>,\n    chunks: Chunk[],\n    {\n      includeSourceMaps,\n      includeBytecode,\n    }: { includeSourceMaps?: boolean; includeBytecode?: boolean }\n  ): Promise<SerialAsset[]> {\n    const jsCode = this.serializeToCode(serializerConfig, chunks);\n\n    const relativeEntry = path.relative(this.options.projectRoot, this.name);\n    const outputFile = this.getFilenameForConfig(\n      // Create hash without wrapping to prevent it changing when the wrapping changes.\n      serializerConfig\n    );\n\n    const jsAsset: SerialAsset = {\n      filename: outputFile,\n      originFilename: relativeEntry,\n      type: 'js',\n      metadata: {\n        isAsync: this.isAsync,\n        requires: [...this.requiredChunks.values()].map((chunk) =>\n          chunk.getFilenameForConfig(serializerConfig)\n        ),\n      },\n      source: jsCode,\n    };\n\n    const assets: SerialAsset[] = [jsAsset];\n\n    if (\n      // Only include the source map if the `options.sourceMapUrl` option is provided and we are exporting a static build.\n      includeSourceMaps &&\n      !this.options.inlineSourceMap &&\n      this.options.sourceMapUrl\n    ) {\n      const modules = [\n        ...this.preModules,\n        ...getSortedModules([...this.deps], {\n          createModuleId: this.options.createModuleId,\n        }),\n      ].map((module) => {\n        // TODO: Make this user-configurable.\n\n        // Make all paths relative to the server root to prevent the entire user filesystem from being exposed.\n        if (module.path.startsWith('/')) {\n          return {\n            ...module,\n            path:\n              '/' + path.relative(this.options.serverRoot ?? this.options.projectRoot, module.path),\n          };\n        }\n        return module;\n      });\n\n      const sourceMap = sourceMapString(modules, {\n        excludeSource: false,\n        ...this.options,\n      });\n\n      assets.push({\n        filename: this.options.dev ? jsAsset.filename + '.map' : outputFile + '.map',\n        originFilename: jsAsset.originFilename,\n        type: 'map',\n        metadata: {},\n        source: sourceMap,\n      });\n    }\n\n    if (includeBytecode && this.isHermesEnabled()) {\n      const adjustedSource = jsAsset.source.replace(\n        /^\\/\\/# (sourceMappingURL)=(.*)$/gm,\n        (...props) => {\n          if (props[1] === 'sourceMappingURL') {\n            const mapName = props[2].replace(/\\.js\\.map$/, '.hbc.map');\n            return `//# ${props[1]}=` + mapName;\n          }\n          return '';\n        }\n      );\n\n      // TODO: Generate hbc for each chunk\n      const hermesBundleOutput = await buildHermesBundleAsync({\n        filename: this.name,\n        code: adjustedSource,\n        map: assets[1] ? assets[1].source : null,\n        // TODO: Maybe allow prod + no minify.\n        minify: true, //!this.options.dev,\n      });\n\n      if (hermesBundleOutput.hbc) {\n        // TODO: Unclear if we should add multiple assets, link the assets, or mutate the first asset.\n        // jsAsset.metadata.hbc = hermesBundleOutput.hbc;\n        // @ts-expect-error: TODO\n        jsAsset.source = hermesBundleOutput.hbc;\n        jsAsset.filename = jsAsset.filename.replace(/\\.js$/, '.hbc');\n      }\n      if (assets[1] && hermesBundleOutput.sourcemap) {\n        assets[1].source = hermesBundleOutput.sourcemap;\n        assets[1].filename = assets[1].filename.replace(/\\.js\\.map$/, '.hbc.map');\n      }\n    }\n\n    return assets;\n  }\n\n  private supportsBytecode() {\n    return this.getPlatform() !== 'web';\n  }\n\n  isHermesEnabled() {\n    // TODO: Revisit.\n    // TODO: There could be an issue with having the serializer for export:embed output hermes since the native scripts will\n    // also create hermes bytecode. We may need to disable in one of the two places.\n    return (\n      !this.options.dev &&\n      this.supportsBytecode() &&\n      this.graph.transformOptions.customTransformOptions?.engine === 'hermes'\n    );\n  }\n}\n\nfunction getEntryModulesForChunkSettings(graph: ReadOnlyGraph, settings: ChunkSettings) {\n  return [...graph.dependencies.entries()]\n    .filter(([path]) => settings.test.test(path))\n    .map(([, module]) => module);\n}\n\nfunction chunkIdForModules(modules: Module[]) {\n  return modules\n    .map((module) => module.path)\n    .sort()\n    .join('=>');\n}\n\nfunction gatherChunks(\n  chunks: Set<Chunk>,\n  settings: ChunkSettings,\n  preModules: readonly Module[],\n  graph: ReadOnlyGraph,\n  options: SerializerOptions<MixedOutput>,\n  isAsync: boolean = false\n): Set<Chunk> {\n  let entryModules = getEntryModulesForChunkSettings(graph, settings);\n\n  const existingChunks = [...chunks.values()];\n\n  entryModules = entryModules.filter((module) => {\n    return !existingChunks.find((chunk) => chunk.entries.includes(module));\n  });\n\n  // Prevent processing the same entry file twice.\n  if (!entryModules.length) {\n    return chunks;\n  }\n\n  const entryChunk = new Chunk(\n    chunkIdForModules(entryModules),\n    entryModules,\n    graph,\n    options,\n    isAsync\n  );\n\n  // Add all the pre-modules to the first chunk.\n  if (preModules.length) {\n    // On native, use the preModules in insert code in the entry chunk.\n    for (const module of preModules.values()) {\n      entryChunk.preModules.add(module);\n    }\n  }\n\n  chunks.add(entryChunk);\n\n  const splitChunks = getSplitChunksOption(graph, options);\n\n  function includeModule(entryModule: Module<MixedOutput>) {\n    for (const dependency of entryModule.dependencies.values()) {\n      if (\n        dependency.data.data.asyncType === 'async' &&\n        // Support disabling multiple chunks.\n        splitChunks\n      ) {\n        gatherChunks(\n          chunks,\n          { test: pathToRegExp(dependency.absolutePath) },\n          [],\n          graph,\n          options,\n          true\n        );\n      } else {\n        const module = graph.dependencies.get(dependency.absolutePath);\n        if (module) {\n          // Prevent circular dependencies from creating infinite loops.\n          if (!entryChunk.deps.has(module)) {\n            entryChunk.deps.add(module);\n            includeModule(module);\n          }\n        }\n      }\n    }\n  }\n\n  for (const entryModule of entryModules) {\n    includeModule(entryModule);\n  }\n\n  return chunks;\n}\n\nasync function serializeChunksAsync(\n  chunks: Set<Chunk>,\n  serializerConfig: Partial<SerializerConfigT>,\n  { includeSourceMaps, includeBytecode }: SerializeChunkOptions\n) {\n  const jsAssets: SerialAsset[] = [];\n\n  const chunksArray = [...chunks.values()];\n  await Promise.all(\n    chunksArray.map(async (chunk) => {\n      jsAssets.push(\n        ...(await chunk.serializeToAssetsAsync(serializerConfig, chunksArray, {\n          includeSourceMaps,\n          includeBytecode,\n        }))\n      );\n    })\n  );\n\n  return jsAssets;\n}\n\nfunction getSortedModules(\n  modules: Module<MixedOutput>[],\n  {\n    createModuleId,\n  }: {\n    createModuleId: (path: string) => number;\n  }\n): readonly Module<any>[] {\n  // Assign IDs to modules in a consistent order\n  for (const module of modules) {\n    createModuleId(module.path);\n  }\n  // Sort by IDs\n  return modules.sort(\n    (a: Module<any>, b: Module<any>) => createModuleId(a.path) - createModuleId(b.path)\n  );\n}\n"],"mappings":"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"}